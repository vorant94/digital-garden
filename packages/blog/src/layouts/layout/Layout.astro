---
import { Analytics } from '@vercel/analytics/react';
import { PROFILE, removeTrailingSlash, THEME } from '@/shared';
import { Header } from './Header';
import { Footer } from './Footer';
import { Meta } from './Meta';
import { Seo } from './Seo';
import { Nav } from './Nav';
import { Background } from '@/components';
import '@/styles/reset.css';

interface Props {
  title?: string;
  image?: string;
  description?: string;
  type?: string;
}

const { title, image, description, type } = Astro.props;
const isProd = import.meta.env.PROD;
const currentPath = removeTrailingSlash(Astro.url.pathname);
---

<!doctype html>
<html
  class="dark:[color-scheme:dark]"
  lang="en"
  prefix="og: https://ogp.me/ns#">
  <head>
    <Meta title={title} />

    <Seo
      currentPath={currentPath}
      title={title}
      image={image}
      description={description}
      type={type}
    />
  </head>
  <body
    class:list={[
      ...THEME.background,
      'flex flex-col min-h-dvh mx-auto md:max-w-md lg:max-w-lg xl:max-w-xl 2xl:max-w-2xl',
    ]}>
    {isProd && <Analytics client:only="react" />}

    <Background />

    <Header>
      <!--
        I'd like to use here React.Children.map and React.cloneElement in order to define isActive inside Nav,
        but Astro currently doesn't allow it since it renders Nav.Link into static HTML before passing to Nav
        as a child, see here https://github.com/withastro/roadmap/discussions/465
      -->
      <Nav>
        {
          PROFILE.navLinks.map((link) => (
            <Nav.Link
              href={link.url}
              isActive={currentPath === link.url}>
              {link.label}
            </Nav.Link>
          ))
        }
      </Nav>
    </Header>

    <main class="flex-1 p-4 flex flex-col gap-2">
      <slot />
    </main>

    <Footer />
  </body>
</html>
