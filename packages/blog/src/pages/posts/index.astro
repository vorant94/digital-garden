---
import { Post } from '../../shared/post.ts';
import { getCollection } from 'astro:content';
import Layout from '../../shared/components/templates/Layout.astro';
import Divider from '../../shared/components/atoms/Divider.astro';
import PostList from '../../shared/components/organisms/PostList.astro';

const entriesByYear = Post.groupEntriesByYear(
  Post.sortEntries(await getCollection('posts')),
);

const years = Object.keys(entriesByYear).reverse();
const postsByYear: Record<string, Post[]> = {};
await Promise.all(
  years.map(async (year) => {
    const entries = entriesByYear[year];
    postsByYear[year] = await Promise.all(
      entries.map((entry) => Post.fromEntry(entry, Post.dateFormatShort)),
    );
  }),
);
---

<Layout title="Posts">
  {
    years.map((year) => (
      <>
        <Divider left={false}>
          <span class="text-xl">{year}</span>
        </Divider>
        <PostList posts={postsByYear[year]} />
      </>
    ))
  }
</Layout>
