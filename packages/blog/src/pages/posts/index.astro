---
import { getCollection } from 'astro:content';
import { MainLayout } from '@/layouts/MainLayout';
import { Divider } from '@/components/Divider';
import { Headline } from '@/components/Headline';
import { PostList } from '@/components/PostList';
import {
  groupPostsByPublishedAtYear,
  sortPostsByPublishedAt,
} from '@/shared/post.helpers';
import { PublishedAtFormat } from '@/shared/collection.helpers';

const postsByYear = groupPostsByPublishedAtYear(
  sortPostsByPublishedAt(await getCollection('posts')),
);

const years = Object.keys(postsByYear).reverse();
---

<MainLayout title="Posts">
  {
    years.map((year) => (
      <>
        <Divider isLeft={false}>
          <Headline>{year}</Headline>
        </Divider>
        <PostList>
          {postsByYear[year]!.map((post) => (
            <PostList.Item
              post={post}
              publishedAtFormat={PublishedAtFormat.SHORT}
            />
          ))}
        </PostList>
      </>
    ))
  }
</MainLayout>
