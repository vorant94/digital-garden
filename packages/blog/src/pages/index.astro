---
import { sortPostsByPublishedAt } from '@/shared';
import { getCollection } from 'astro:content';
import { partition } from 'lodash-es';
import { MainLayout } from '@/layouts';
import {
  Intro,
  PostTiledList,
  PinnedPosts,
  Link,
  Carousel,
  Divider,
  Headline,
  ProjectCard,
} from '@/components';

const allPosts = sortPostsByPublishedAt(await getCollection('posts'));
const [pinnedPosts, allNonPinnedPosts] = partition(
  allPosts,
  (entry) => entry.data.isPinned,
);

const recentNonPunnedPosts = allNonPinnedPosts.slice(0, 3);

const projects = await getCollection('projects');
---

<MainLayout>
  <PinnedPosts posts={pinnedPosts} />

  <Intro />

  <Divider>
    <Headline>Recently Published</Headline>
  </Divider>

  <PostTiledList>
    {recentNonPunnedPosts.map((post) => <PostTiledList.Item post={post} />)}
  </PostTiledList>

  <Link
    className="self-center"
    href="posts">
    See all posts
  </Link>

  <Divider>
    <Headline>My Projects</Headline>
  </Divider>

  <Carousel client:load>
    {
      projects.map((project) => (
        <Carousel.Slide client:load>
          <ProjectCard
            client:load
            project={project}
          />
        </Carousel.Slide>
      ))
    }
  </Carousel>
</MainLayout>
