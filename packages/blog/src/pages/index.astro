---
import { getCollection } from 'astro:content';
import { partition } from 'lodash-es';
import MainLayout from '@/layouts/MainLayout/MainLayout.astro';
import { Intro } from '@/components/Intro/Intro.tsx';
import { PostTiledList } from '@/components/PostTiledList/PostTiledList.tsx';
import { PostTiledListItem } from '@/components/PostTiledList/PostTiledListItem.tsx';
import { PinnedPosts } from '@/components/PinnedPosts.tsx';
import { Link } from '@/components/Link.tsx';
import { sortEntriesByPublishedAt } from '@/shared/collection.helpers.ts';

const allPosts = sortEntriesByPublishedAt(await getCollection('posts'));
const [pinnedPosts, allNonPinnedPosts] = partition(
  allPosts,
  (entry) => entry.data.isPinned,
);

const recentNonPunnedPosts = allNonPinnedPosts.slice(0, 3);
---

<MainLayout>
  <PinnedPosts posts={pinnedPosts} />

  <Intro />

  <PostTiledList>
    {recentNonPunnedPosts.map((post) => <PostTiledListItem post={post} />)}
  </PostTiledList>

  <Link
    className="self-center"
    prefetch="hover"
    href="posts">
    See all posts
  </Link>
</MainLayout>
