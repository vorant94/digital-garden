---
import { sortPostsByPublishedAt } from '../shared';
import { getCollection } from 'astro:content';
import { partition } from 'lodash-es';
import Layout from '../components/templates/Layout.astro';
import { Intro, PostGrid, PinnedPosts, Link } from '../components';

const allPosts = sortPostsByPublishedAt(await getCollection('posts'));
const [pinnedPosts, allNonPinnedPosts] = partition(
  allPosts,
  (entry) => entry.data.isPinned,
);

const recentNonPunnedPosts = allNonPinnedPosts.slice(0, 3);
---

<Layout>
  <PinnedPosts posts={pinnedPosts} />

  <Intro />

  <PostGrid posts={recentNonPunnedPosts} />

  <Link
    className="self-center"
    href="posts">
    See all posts
  </Link>
</Layout>
